<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kamphak Grand Orientation 2024</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <!-- Introduction Page (Page 1) -->
    <div class="container show fade-in" id="introductionPage">
        <h1>ยินดีต้อนรับสู่</h1>
		<h1 id='jschanok_h1'>อบรมใหญ่</h1>
	    <h1 id='jschanok_h1'>งานรับน้องข้ามฟาก</h1>
		<h1>2567</h1>
        <p>นี่เป็นแบบสำรวจใจเล็ก ๆ น้อย ๆ ที่พี่ ๆ Senior130 อยากชวนน้อง Freshy134 ทำไปด้วยกัน</p>
		<p>Disclaimer : เนื้อหาและข้อมูลทั้งหมดของแบบสำรวจในวันงานจริงเป็นความลับและจะไม่ถูกนำไปเผยแพร่เด็ดขาด</p>
        <button id="proceedButton">ตกลง</button>
    </div>

    <!-- Student ID Page (Page 2) -->
    <div class="container" id="studentIDPage">
        <h1>ใส่รหัสนักศึกษาของน้องเลย</h1>
        <input type="text" id="studentID" placeholder="ใส่โลดจ้า">
        <p id="error-message" class="error">ไม่พบรหัสดังกล่าวในระบบ โปรดลองอีกครั้ง</p>
        <button id="submitID">ยืนยัน</button>
    </div>

    <!-- Confirmation Page (Page 3) -->
    <div class="container" id="confirmationPage">
        <h1>น้อง <span id="nickname"></span> ใช่มั้ยครับ?</h1>
        <h2>ยืนยันตัวตนด้วยเลขที่นั่งโต๊ะแลป</h2>
		<p>ใส่เป็นตัวเลขไม่ต้องสนจำนวนหลัก เช่น 1 ให้ใส่ 1 เลย</p>
        <input type="text" id="tableNumber" placeholder="ใส่โลดจ้า">
        <p id="table-error-message" class="error">เลขโต๊ะแลปไม่ถูกต้อง โปรดลองอีกครั้ง</p>
        <button id="confirmTableNumber">ยืนยันตัวตน</button>
        <button id="reenterID">ย้อนกลับ</button>
    </div>

    <script>
        // Function to handle transitions between pages
        function transitionPages(fromPage, toPage) {
            fromPage.classList.remove('fade-in');
            setTimeout(() => {
                fromPage.classList.remove('show');  // Hide the current page after fade-out

                // Show and fade in the next page
                toPage.classList.add('show');
                setTimeout(() => {
                    toPage.classList.add('fade-in');
                }, 10);  // Delay to ensure the element becomes visible before applying fade-in
            }, 2000);  // Wait for 3 seconds (fade-out duration)
        }

        // Function to fetch student data from JSON
        async function fetchStudentData() {
            try {
                console.log("Fetching student data...");  // Debugging
                const response = await fetch('freshies.json');  // Make sure the path is correct
                const studentData = await response.json();  // Convert the response to JSON format
                console.log("Fetched student data:", studentData);  // Debugging
                return studentData;
            } catch (error) {
                console.error("Error fetching student data:", error);
            }
        }

        // Handle the "I Agree and Proceed" button to transition from introduction to Student ID page
        document.getElementById('proceedButton').addEventListener('click', function() {
            const introductionPage = document.getElementById('introductionPage');
            const studentIDPage = document.getElementById('studentIDPage');
            transitionPages(introductionPage, studentIDPage);  // Transition to student ID input page
        });

        // Function to validate student ID and transition to confirmation page
        async function validateStudentID() {
            const studentID = document.getElementById('studentID').value;
            const errorMessage = document.getElementById('error-message');
            const studentIDPage = document.getElementById('studentIDPage');
            const confirmationPage = document.getElementById('confirmationPage');
            const nicknameElement = document.getElementById('nickname');

            const studentData = await fetchStudentData();  // Fetch student data from JSON file
            console.log("Student ID entered:", studentID);  // Debugging

            // Check if the entered student ID exists in the JSON data
            const foundStudent = studentData.find(student => student.studentid == studentID);
            console.log("Found student:", foundStudent);  // Debugging

            if (foundStudent) {
                // Show the confirmation page and display the nickname
                nicknameElement.textContent = foundStudent.nickname;
                console.log("Displaying nickname:", foundStudent.nickname);  // Debugging

                // Save student info temporarily for confirmation
                localStorage.setItem('tempStudentID', foundStudent.studentid);
                localStorage.setItem('tempStudentName', foundStudent.nickname);
                localStorage.setItem('tempTableID', foundStudent.tableid);

                // Transition from ID input page to confirmation page
                transitionPages(studentIDPage, confirmationPage);
            } else {
                // Show error message if the student ID is not found
                errorMessage.style.display = 'block';
            }
        }

        // Handle table number confirmation
        document.getElementById('confirmTableNumber').addEventListener('click', function() {
            const tableNumber = document.getElementById('tableNumber').value;
            const storedTableID = localStorage.getItem('tempTableID');
            const tableErrorMessage = document.getElementById('table-error-message');

            // Validate the entered table number against the stored table ID
            if (tableNumber === storedTableID) {
                // Move data from temp storage to permanent storage
                localStorage.setItem('studentID', localStorage.getItem('tempStudentID'));
                localStorage.setItem('studentName', localStorage.getItem('tempStudentName'));
                localStorage.setItem('tableID', localStorage.getItem('tempTableID'));

                // Redirect to the next page or part of the story
                window.location.href = 'question1.html';  // Proceed to the next section
            } else {
                // Show error message if the table number is incorrect
                tableErrorMessage.style.display = 'block';
            }
        });

        // Handle re-entering student ID
        document.getElementById('reenterID').addEventListener('click', function() {
            // Clear temp data and return to the ID input page
            localStorage.removeItem('tempStudentID');
            localStorage.removeItem('tempStudentName');
            localStorage.removeItem('tempTableID');
            document.getElementById('studentID').value = '';  // Clear the input field
            document.getElementById('tableNumber').value = '';  // Clear the table number field
            document.getElementById('table-error-message').style.display = 'none';  // Hide the table error

            const confirmationPage = document.getElementById('confirmationPage');
            const studentIDPage = document.getElementById('studentIDPage');
            transitionPages(confirmationPage, studentIDPage);  // Transition back to ID input page
        });

        // Handle the submit button click to validate and proceed
        document.getElementById('submitID').addEventListener('click', validateStudentID);
    </script>
</body>
</html>
