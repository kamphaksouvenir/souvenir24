<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Self-Reflection Story - Transitions</title>
    <style>
        /* Basic reset */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        /* Full height container */
        html, body {
            height: 100%;
            font-family: Arial, sans-serif;
        }

        /* Container for each page */
        .container {
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            opacity: 0;
            transition: opacity 3s ease;  /* 3 seconds fade-in and fade-out */
        }

        /* Show container */
        .show {
            display: flex;  /* Makes the container visible */
        }

        /* Fade-in effect */
        .fade-in {
            opacity: 1;
        }

        /* Input and button styling */
        input, button {
            padding: 10px;
            margin: 10px 0;
            font-size: 16px;
        }

        input {
            width: 250px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        button {
            background-color: black;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: opacity 0.5s ease;
        }

        button:active {
            opacity: 0;  /* Button fades to transparent when clicked */
        }

        /* Error and confirmation messages */
        .error {
            color: red;
            font-size: 14px;
            display: none;
        }

        /* Initially hidden */
        #confirmationPage {
            display: none;
        }

    </style>
</head>
<body>

    <!-- Introduction Page (Page 1) -->
    <div class="container show fade-in" id="introductionPage">
        <h1>Welcome to the Self-Reflection Story</h1>
        <p>Before starting, please read the following rules and give your consent.</p>
        <button id="proceedButton">I Agree and Proceed</button>
    </div>

    <!-- Student ID Page (Page 2) -->
    <div class="container" id="studentIDPage">
        <h1>Enter Your Student ID</h1>
        <input type="text" id="studentID" placeholder="Enter your student ID">
        <p id="error-message" class="error">Invalid Student ID. Please try again.</p>
        <button id="submitID">Submit</button>
    </div>

    <!-- Confirmation Page (Page 3) -->
    <div class="container" id="confirmationPage">
        <h1>Confirm Your Name</h1>
        <p id="nicknameConfirmation"></p>
        <button id="confirmYes">Yes</button>
        <button id="confirmNo">No</button>
    </div>

    <script>
        // Function to handle transitions between pages
        function transitionPages(fromPage, toPage) {
            // Fade out the current page
            fromPage.classList.remove('fade-in');
            setTimeout(() => {
                fromPage.classList.remove('show');  // Hide the current page after fade-out

                // Show and fade in the next page
                toPage.classList.add('show');
                setTimeout(() => {
                    toPage.classList.add('fade-in');
                }, 10);  // Delay to ensure the element becomes visible before applying fade-in
            }, 3000);  // Wait for 3 seconds (fade-out duration)
        }

        // Function to fetch student data from JSON
        async function fetchStudentData() {
            try {
                const response = await fetch('freshies.json');  // Fetch the freshies.json file
                const studentData = await response.json();  // Convert the response to JSON format
                return studentData;
            } catch (error) {
                console.error("Error fetching student data:", error);
            }
        }

        // Handle the "I Agree and Proceed" button to transition from introduction to Student ID page
        document.getElementById('proceedButton').addEventListener('click', function() {
            const introductionPage = document.getElementById('introductionPage');
            const studentIDPage = document.getElementById('studentIDPage');
            transitionPages(introductionPage, studentIDPage);  // Transition to student ID input page
        });

        // Function to validate student ID and transition to confirmation page
        async function validateStudentID() {
            const studentID = document.getElementById('studentID').value;
            const errorMessage = document.getElementById('error-message');
            const studentIDPage = document.getElementById('studentIDPage');
            const confirmationPage = document.getElementById('confirmationPage');
            const nicknameConfirmation = document.getElementById('nicknameConfirmation');

            const studentData = await fetchStudentData();  // Fetch student data from JSON file

            // Check if the entered student ID exists in the JSON data
            const foundStudent = studentData.find(student => student.studentID === studentID);

            if (foundStudent) {
                // Show the confirmation page and display the nickname
                nicknameConfirmation.textContent = `Is your name ${foundStudent.name}?`;
                
                // Save student info temporarily for confirmation
                localStorage.setItem('tempStudentID', foundStudent.studentID);
                localStorage.setItem('tempStudentName', foundStudent.name);

                // Transition from ID input page to confirmation page
                transitionPages(studentIDPage, confirmationPage);
            } else {
                // Show error message if the student ID is not found
                errorMessage.style.display = 'block';
            }
        }

        // Handle the confirmation buttons
        document.getElementById('confirmYes').addEventListener('click', function() {
            // Move data from temp storage to permanent storage
            localStorage.setItem('studentID', localStorage.getItem('tempStudentID'));
            localStorage.setItem('studentName', localStorage.getItem('tempStudentName'));

            // Redirect to the next page or part of the story
            window.location.href = 'question1.html';  // Proceed to the next section
        });

        document.getElementById('confirmNo').addEventListener('click', function() {
            // Clear temp data and return to the ID input page
            localStorage.removeItem('tempStudentID');
            localStorage.removeItem('tempStudentName');
            document.getElementById('studentID').value = '';  // Clear the input field

            const confirmationPage = document.getElementById('confirmationPage');
            const studentIDPage = document.getElementById('studentIDPage');
            transitionPages(confirmationPage, studentIDPage);  // Transition back to ID input page
        });

        // Handle the submit button click to validate and proceed
        document.getElementById('submitID').addEventListener('click', validateStudentID);
    </script>
</body>
</html>
